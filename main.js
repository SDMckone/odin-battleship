(()=>{"use strict";const e=class{constructor(e,t){this.shipsAndLocations=[],this.occupiedCoords=[],this.width=e,this.height=t}placeShip(e,t,i,s){const o=new class{constructor(e=5){this.length=e,this.hits=0}hit(){this.hits+=1}isSunk(){return this.hits===this.length}}(e),r=[];if(s){if(i+e>this.width)return!1;for(let s=i;s<e+i;s+=1)r.push([t,s])}else{if(t+e>this.height)return!1;for(let s=t;s<e+t;s+=1)r.push([s,i])}for(let e=0;e<this.occupiedCoords.length;e+=1)for(let t=0;t<r.length;t+=1)if(this.occupiedCoords[e][0]===r[t][0]&&this.occupiedCoords[e][1]===r[t][1])return!1;return this.shipsAndLocations.push({ship:o,coordsArray:r}),this.occupiedCoords=this.occupiedCoords.concat(r),!0}placeShipsRandomly(e){for(let t=0;t<e.length;t+=1){let i;do{i=this.placeShip(e[t],Math.floor(Math.random()*this.height),Math.floor(Math.random()*this.width),Math.random()<.5)}while(!i)}}receiveAttack(e,t){for(let i=0;i<this.shipsAndLocations.length;i+=1)for(let s=0;s<this.shipsAndLocations[i].coordsArray.length;s+=1)if(e===this.shipsAndLocations[i].coordsArray[s][0]&&t===this.shipsAndLocations[i].coordsArray[s][1])return this.shipsAndLocations[i].ship.hit(),!0;return!1}allSunk(){for(let e=0;e<this.shipsAndLocations.length;e+=1)if(!this.shipsAndLocations[e].ship.isSunk())return!1;return!0}isCoordOccupied(e,t){for(let i=0;i<this.occupiedCoords.length;i+=1)if(this.occupiedCoords[i][0]===e&&this.occupiedCoords[i][1]===t)return!0;return!1}},t=class{constructor(e,t=null){this.gridContainer=document.createElement("div"),this.gridContainer.classList.add("grid-container"),this.gameboard=e,this.otherDomGrid=t;for(let e=0;e<this.gameboard.height;e+=1){const e=document.createElement("div");e.classList.add("grid-row-container");for(let t=0;t<this.gameboard.width;t+=1){const t=document.createElement("div");t.classList.add("grid-square"),t.classList.add("clear"),e.appendChild(t)}this.gridContainer.appendChild(e)}}setSquareColor(e,t,i){const s=this.gridContainer.children.item(e).children.item(t);switch(s.classList.remove("clear","hit","miss","ship","ship-placement"),i){case"clear":s.classList.add("clear");break;case"hit":s.classList.add("hit");break;case"miss":s.classList.add("miss");break;case"ship":s.classList.add("ship");break;case"ship-placement":s.classList.add("ship-placement")}}renderShips(){for(let e=0;e<this.gameboard.shipsAndLocations.length;e+=1)for(let t=0;t<this.gameboard.shipsAndLocations[e].coordsArray.length;t+=1)this.setSquareColor(this.gameboard.shipsAndLocations[e].coordsArray[t][0],this.gameboard.shipsAndLocations[e].coordsArray[t][1],"ship")}makeHostileGrid(){const e=new class{constructor(e){this.gameBoard=e,this.coordList=[];for(let t=0;t<e.width;t+=1)for(let i=0;i<e.height;i+=1)this.coordList.push([t,i])}makeMove(){const e=Math.floor(Math.random()*this.coordList.length),t=this.coordList[e];this.coordList.splice(e,1);const i=[];return i.push(this.gameBoard.receiveAttack(t[0],t[1])),i.push(t),this.gameBoard.allSunk()&&(alert("Hostile won"),document.body.style.display="none"),i}}(this.otherDomGrid.gameboard);for(let t=0;t<this.gridContainer.children.length;t+=1)for(let i=0;i<this.gridContainer.children.item(t).children.length;i+=1){const s=this.gridContainer.children.item(t).children.item(i);s.classList.add("hostile-side"),s.addEventListener("click",(()=>{if(s.classList.contains("clear")){const o=this.gameboard.receiveAttack(t,i);s.classList.remove("clear"),o?s.classList.add("hit"):s.classList.add("miss");const r=e.makeMove();r[0]?this.otherDomGrid.setSquareColor(r[1][0],r[1][1],"hit"):this.otherDomGrid.setSquareColor(r[1][0],r[1][1],"miss")}this.gameboard.allSunk()&&(alert("Player won"),document.body.style.display="none")}))}}makePlacementGrid(e){let t=!1,i=0;for(let s=0;s<this.gridContainer.children.length;s+=1)for(let o=0;o<this.gridContainer.children.item(s).children.length;o+=1){const r=this.gridContainer.children.item(s).children.item(o),a=()=>{if(t)for(let t=0;t<e[i];t+=1)!this.gameboard.isCoordOccupied(s,o+t)&&s<this.gameboard.height&&o+t<this.gameboard.width&&this.setSquareColor(s,o+t,"ship-placement");else for(let t=0;t<e[i];t+=1)!this.gameboard.isCoordOccupied(s+t,o)&&s+t<this.gameboard.height&&o<this.gameboard.width&&this.setSquareColor(s+t,o,"ship-placement")};r.addEventListener("mouseover",a);const d=()=>{if(t)for(let t=0;t<e[i];t+=1)!this.gameboard.isCoordOccupied(s,o+t)&&s<this.gameboard.height&&o+t<this.gameboard.width&&this.setSquareColor(s,o+t,"clear");else for(let t=0;t<e[i];t+=1)!this.gameboard.isCoordOccupied(s+t,o)&&s+t<this.gameboard.height&&o<this.gameboard.width&&this.setSquareColor(s+t,o,"clear")};r.addEventListener("mouseleave",d),r.addEventListener("click",(()=>{this.gameboard.placeShip(e[i],s,o,t)&&(this.renderShips(),i+=1,r.removeEventListener("mouseover",a),r.removeEventListener("mouseleave",d),i===e.length&&(document.querySelector("#start-screen").style.display="none",document.body.classList.remove("low-opacity-bg"),document.querySelector("#content").classList.remove("low-opacity"),this.otherDomGrid.renderShips()))})),r.addEventListener("contextmenu",d),r.addEventListener("contextmenu",(e=>{e.preventDefault(),t=!t})),r.addEventListener("contextmenu",a)}}},i=document.querySelector("#placement-grid"),s=new e(10,10),o=new t(s),r=new t(s,o);r.makePlacementGrid([5,4,3,2,2,1,1]),i.appendChild(r.gridContainer),document.querySelector("#player-side").appendChild(o.gridContainer);const a=document.querySelector("#hostile-side"),d=new e(10,10);d.placeShipsRandomly([5,4,3,2,2,1,1]);const h=new t(d,o);h.makeHostileGrid(),a.appendChild(h.gridContainer)})();